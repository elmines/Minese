program : definition
        | definition program

definition : classDef
           | varDef



classDef : CLASS IDENTIFIER optExtension LEFT_CURLY classBody RIGHT_CURLY

optExtension : NONE
             | EXTENDS IDENTIFIER

classBody : varDef
          | varDef classBody



varDef : VAR IDENTIFIER optAssignment SEMICOLON
       | functionDef

optAssignment : NONE
              | ASSIGN expression



functionDef : IDENTIFIER functionSig block

functionSig : LEFT_PAREN optParamsList RIGHT_PAREN

optParamsList : NONE
              | paramsList

paramsList : IDENTIFIER
           | IDENTIFIER COMMA paramsList

block : LEFT_CURLY optStatements RIGHT_CURLY
      | statement




optStatements : NONE
              | statements

statements : statement
           | statement statements

statement : condBlock
          | whileBlock
          | expression  SEMICOLON
          | varDef      SEMICOLON
          | functionDef SEMICOLON
          | returnStatement


condStatement : IF condition block |
              : IF condition block ELSE block

whileHeader : WHILE condition block

condition : LEFT_PAREN expression RIGHT_PAREN

returnStatement : RETURN expression SEMICOLON
                | RETURN SEMICOLON




expression : unary
           | unary operator expression

unary: MINUS unary
     | LEFT_PAREN expression RIGHT_PAREN
     | functionCall
     | array
     | arrayElement
     | closure
     | variable
     | INTEGER
     | STRING

functionCall : variable LEFT_PAREN optExprList RIGHT_PAREN

optExprList : NONE
            | exprList

exprList : expression
         | expression COMMA exprList

array : LEFT_CURLY exprList RIGHT_CURLY

arrayElement : IDENTIFIER LEFT_BRACK INTEGER RIGHT_BRACK

closure : functionSig ARROW block

variable: IDENTIFIER
        | IDENTIFIER DOT variable

operator : PLUS
         | TIMES
         | MINUS
         | DIV
         | MOD
         | LT
         | LTE
         | EQ
         | GTE
         | GT
         | ASSIGN
